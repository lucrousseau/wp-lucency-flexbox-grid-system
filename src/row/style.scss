@use "sass:math";

$columns: 12;

$xxl: 1400px;
$xl: 1200px;
$lg: 992px;
$md: 768px;
$sm: 576px;
$xs: 480px;

$breakpoints: (
	xxl: $xxl,
	xl: $xl,
	lg: $lg,
	md: $md,
	sm: $sm,
	xs: $xs,
);

@mixin respondTo($breakpoint) {
	@if map-has-key($breakpoints, $breakpoint) {
		@media (max-width: map-get($breakpoints, $breakpoint)) {
			@content;
		}
	} @else {
		@warn "Unknown breakpoint: #{$breakpoint}.";
	}
}

@function findPreviousBreakepoint($prefix, $return: "prefix") {
	$previousPrefix: null;
	$previousBreakpoint: null;

	@each $currentPrefix, $currentBreakpoint in $breakpoints {
		@if $currentPrefix == $prefix and $previousPrefix != null {
			@if $return == "prefix" {
				@return getPrefix($previousPrefix);
			} @else {
				@return $previousBreakpoint;
			}
		}

		$previousPrefix: $currentPrefix;
		$previousBreakpoint: $currentBreakpoint;
	}

	@return null;
}
@function getPrefix($prefix: "") {
	@return if($prefix == "", $prefix, "#{$prefix}-");
}

@mixin colwidth($size, $prefix: "") {
	$prefix: getPrefix($prefix);

	&.col--#{$prefix}#{$size} {
		flex: 0 0 (math.div(100%, $columns) * $size);
		max-width: (math.div(100%, $columns) * $size);
	}
}

.row {
	display: flex;
	flex-wrap: wrap;

	--get-margin-top: var(--margin-top, 0);
	--get-margin-right: var(--margin-right, 0);
	--get-margin-bottom: var(--margin-bottom, 0);
	--get-margin-left: var(--margin-left, 0);

	margin: var(
			--get-margin-top,
			0 var(--get-margin-right, 0) var(--get-margin-bottom, 0)
		)
		var(--get-margin-left, 0);

	@each $prefix, $breakpoint in $breakpoints {
		@include respondTo($prefix) {
			content: "current prefix : #{$prefix} ";
			$previousPrefix: findPreviousBreakepoint($prefix);

			--get-#{$prefix}-margin-top: var(
				--#{$prefix}-margin-top,
				var(--get-#{$previousPrefix}margin-top)
			);
			--get-#{$prefix}-margin-right: var(
				--#{$prefix}-margin-right,
				var(--get-#{$previousPrefix}margin-right)
			);
			--get-#{$prefix}-margin-bottom: var(
				--#{$prefix}-margin-bottom,
				var(--get-#{$previousPrefix}margin-bottom)
			);
			--get-#{$prefix}-margin-left: var(
				--#{$prefix}-margin-left,
				var(--get-#{$previousPrefix}margin-left)
			);

			margin: var(
					--get-#{$prefix}-margin-top,
					var(--get-#{$previousPrefix}margin-top)
				)
				var(
					--get-#{$prefix}-margin-right,
					var(--get-#{$previousPrefix}margin-right)
				)
				var(
					--get-#{$prefix}-margin-bottom,
					var(--get-#{$previousPrefix}margin-bottom)
				)
				var(
					--get-#{$prefix}-margin-left,
					var(--get-#{$previousPrefix}margin-left)
				);
		}
	}

	> .col {
		flex: 1;
		position: relative;

		@for $i from 1 through $columns {
			@include colwidth($i);
		}

		@each $prefix, $breakpoint in $breakpoints {
			@for $i from 1 through $columns {
				@include respondTo($prefix) {
					@include colwidth($i, $prefix);
				}
			}
		}
	}
}
